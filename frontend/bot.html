<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>GeoAI Bot Runner v2.0</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root{
  --bg-0:#07071100;--bg-1:#0d0d1a;--bg-2:#12121f;--bg-3:#1a1a2e;--bg-4:#20203a;
  --indigo:#6366f1;--purple:#a855f7;--cyan:#06b6d4;--emerald:#10b981;
  --rose:#f43f5e;--amber:#f59e0b;--sky:#38bdf8;
  --text-1:#f1f5f9;--text-2:#94a3b8;--text-3:#475569;
  --r:12px;--rs:8px;--rl:16px;--tr:all .2s ease;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',sans-serif;background:#070711;color:var(--text-1);min-height:100vh;overflow-x:hidden}
a{color:inherit;text-decoration:none}button{cursor:pointer;font-family:'Inter',sans-serif}

/* BG */
.orbs{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
.orb{position:absolute;border-radius:50%;filter:blur(90px);opacity:.1}
.o1{width:700px;height:700px;background:radial-gradient(circle,var(--indigo),transparent);top:-250px;left:-200px;animation:d1 20s ease-in-out infinite alternate}
.o2{width:600px;height:600px;background:radial-gradient(circle,var(--purple),transparent);bottom:-200px;right:-150px;animation:d2 25s ease-in-out infinite alternate}
.o3{width:400px;height:400px;background:radial-gradient(circle,var(--cyan),transparent);top:50%;left:50%;transform:translate(-50%,-50%);animation:d3 16s ease-in-out infinite alternate}
@keyframes d1{to{transform:translate(50px,30px)}}
@keyframes d2{to{transform:translate(-40px,-50px)}}
@keyframes d3{to{transform:translate(20px,-20px)}}

#app{position:relative;z-index:1}
.wrap{max-width:1200px;margin:0 auto;padding:24px 20px 100px}

/* NAVBAR */
nav{position:sticky;top:0;z-index:100;display:flex;align-items:center;gap:8px;padding:0 20px;height:56px;background:rgba(7,7,17,.9);backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,.06)}
.logo{display:flex;align-items:center;gap:9px;font-weight:800;font-size:16px}
.logo-badge{background:rgba(99,102,241,.2);border:1px solid rgba(99,102,241,.4);color:var(--indigo);font-size:9px;font-weight:800;padding:2px 7px;border-radius:99px;letter-spacing:.5px;text-transform:uppercase}
.spacer{flex:1}
.nbtn{display:flex;align-items:center;gap:6px;padding:6px 13px;border-radius:var(--rs);background:transparent;border:1px solid rgba(255,255,255,.08);color:var(--text-2);font-size:13px;font-weight:600;transition:var(--tr)}
.nbtn:hover{background:rgba(255,255,255,.06);color:var(--text-1)}
.nbtn.active{background:rgba(99,102,241,.15);border-color:rgba(99,102,241,.4);color:var(--indigo)}
.nbtn i{font-size:12px}

/* SETTINGS PANEL */
.sov{position:fixed;inset:0;z-index:150;background:rgba(0,0,0,.65);backdrop-filter:blur(4px);opacity:0;pointer-events:none;transition:opacity .25s}
.sov.open{opacity:1;pointer-events:all}
.spanel{position:fixed;top:64px;left:50%;transform:translateX(-50%) translateY(-16px);z-index:160;width:min(680px,calc(100vw - 32px));background:var(--bg-2);border:1px solid rgba(99,102,241,.2);border-radius:var(--rl);box-shadow:0 40px 100px rgba(0,0,0,.85);padding:28px;opacity:0;pointer-events:none;transition:opacity .3s,transform .3s}
.spanel.open{opacity:1;pointer-events:all;transform:translateX(-50%) translateY(0)}
.stitle{display:flex;align-items:center;gap:10px;font-size:15px;font-weight:800;margin-bottom:22px}
.stitle i{color:var(--indigo)}
.sgrid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:500px){.sgrid{grid-template-columns:1fr}}
.sf{display:flex;flex-direction:column;gap:6px}
.sf.full{grid-column:1/-1}
.sf label{font-size:11px;font-weight:700;color:var(--text-3);text-transform:uppercase;letter-spacing:.6px;display:flex;align-items:center;gap:5px}
.sf label i{color:var(--indigo);font-size:10px}
.si{background:var(--bg-3);border:1px solid rgba(255,255,255,.07);border-radius:var(--rs);color:var(--text-1);font-family:'JetBrains Mono',monospace;font-size:13px;padding:10px 14px;outline:none;transition:border-color .2s;width:100%}
.si:focus{border-color:var(--indigo)}
.si::placeholder{color:var(--text-3)}
input[type="password"].si{letter-spacing:3px}input[type="password"].si:focus{letter-spacing:normal}
.shint{font-size:11px;color:var(--text-3);margin-top:3px;display:flex;align-items:center;gap:5px}
.shint i{color:var(--amber)}
.srow{display:flex;align-items:center;gap:12px;margin-top:16px;padding-top:16px;border-top:1px solid rgba(255,255,255,.06)}
.srow-label{font-size:13px;font-weight:600;color:var(--text-2);flex:1}
.cc{display:flex;align-items:center;gap:10px}
.cc button{width:28px;height:28px;border-radius:var(--rs);background:var(--bg-3);border:1px solid rgba(255,255,255,.1);color:var(--text-1);font-size:16px;font-weight:700;display:flex;align-items:center;justify-content:center;transition:var(--tr)}
.cc button:hover{background:var(--bg-4);border-color:var(--indigo)}
.ccv{font-family:'JetBrains Mono',monospace;font-size:16px;font-weight:700;color:var(--indigo);min-width:28px;text-align:center}
.sact{display:flex;gap:10px;margin-top:18px;justify-content:flex-end}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:7px;padding:10px 20px;border-radius:var(--rs);border:none;font-family:'Inter',sans-serif;font-size:14px;font-weight:700;transition:var(--tr);white-space:nowrap}
.btn i{font-size:13px}
.btn-p{background:linear-gradient(135deg,var(--indigo),var(--purple));color:#fff;box-shadow:0 4px 20px rgba(99,102,241,.3)}
.btn-p:hover{filter:brightness(1.1);transform:translateY(-1px);box-shadow:0 8px 28px rgba(99,102,241,.4)}
.btn-p.running{animation:pulse-ring 1.5s ease-in-out infinite}
@keyframes pulse-ring{0%,100%{box-shadow:0 4px 20px rgba(99,102,241,.3)}50%{box-shadow:0 4px 32px rgba(99,102,241,.7),0 0 0 8px rgba(99,102,241,.1)}}
.btn-g{background:transparent;border:1px solid rgba(255,255,255,.1);color:var(--text-2)}
.btn-g:hover{background:rgba(255,255,255,.06);color:var(--text-1)}
.btn-d{background:rgba(244,63,94,.1);border:1px solid rgba(244,63,94,.3);color:var(--rose)}
.btn-d:hover{background:rgba(244,63,94,.2)}
.btn-sm{padding:7px 14px;font-size:13px}
.btn:disabled{opacity:.4;pointer-events:none}

/* HERO */
.hero{padding:56px 20px 40px;text-align:center}
.hero-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(99,102,241,.1);border:1px solid rgba(99,102,241,.25);color:var(--indigo);padding:6px 16px;border-radius:99px;font-size:13px;font-weight:700;margin-bottom:18px}
.hero-title{font-size:clamp(26px,5vw,50px);font-weight:900;line-height:1.1;letter-spacing:-1.5px;margin-bottom:12px;background:linear-gradient(135deg,#fff 0%,var(--indigo) 50%,var(--cyan) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero-sub{font-size:15px;color:var(--text-2);line-height:1.7;max-width:540px;margin:0 auto 24px}
.cstatus{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-bottom:22px}
.cpill{display:inline-flex;align-items:center;gap:6px;padding:5px 13px;border-radius:99px;font-size:12px;font-weight:700;border:1px solid transparent;transition:var(--tr)}
.cpill.ok{background:rgba(16,185,129,.1);border-color:rgba(16,185,129,.3);color:var(--emerald)}
.cpill.warn{background:rgba(245,158,11,.1);border-color:rgba(245,158,11,.3);color:var(--amber)}
.cpill.err{background:rgba(244,63,94,.1);border-color:rgba(244,63,94,.3);color:var(--rose)}
.rctrl{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-bottom:20px}

/* LIVE TIMER */
.ltimer{display:none;justify-content:center;align-items:center;gap:12px;margin-bottom:20px;font-family:'JetBrains Mono',monospace}
.ltimer.on{display:flex}
.ldot{width:7px;height:7px;border-radius:50%;background:var(--emerald);animation:blink 1s ease-in-out infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.15}}
.lval{font-size:13px;color:var(--text-2);font-weight:600}
.lval b{color:var(--emerald)}

/* STATS BAR */
.sbar{display:grid;grid-template-columns:repeat(7,1fr);background:var(--bg-1);border:1px solid rgba(255,255,255,.06);border-radius:var(--r);overflow:hidden;margin-bottom:28px}
@media(max-width:700px){.sbar{grid-template-columns:repeat(4,1fr)}.si4{display:none}}
.sitem{padding:15px 8px;text-align:center;border-right:1px solid rgba(255,255,255,.05)}
.sitem:last-child{border-right:none}
.sv{font-size:22px;font-weight:800;line-height:1;margin-bottom:3px;font-variant-numeric:tabular-nums;transition:color .3s}
.sv.blue{color:var(--sky)}.sv.purple{color:var(--purple)}.sv.green{color:var(--emerald)}.sv.red{color:var(--rose)}.sv.amber{color:var(--amber)}.sv.cyan{color:var(--cyan)}.sv.indigo{color:var(--indigo)}
.sl{font-size:10px;color:var(--text-3);font-weight:700;text-transform:uppercase;letter-spacing:.5px}

/* PROGRESS */
.pwrap{margin-bottom:24px}
.phdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.ptitle{font-size:13px;font-weight:700;color:var(--text-2);display:flex;align-items:center;gap:6px}
.ptitle i{color:var(--indigo)}
.pmeta{font-size:12px;color:var(--text-3);font-family:'JetBrains Mono',monospace}
.ptrack{height:7px;background:var(--bg-3);border-radius:99px;overflow:hidden}
.pfill{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--indigo),var(--purple),var(--cyan));background-size:200% 100%;transition:width .4s ease;animation:shimmer 2s linear infinite}
@keyframes shimmer{0%{background-position:200% center}100%{background-position:-200% center}}

/* CONTINENT */
.cont-sec{margin-bottom:10px;border:1px solid rgba(255,255,255,.06);border-radius:var(--r);overflow:hidden;background:var(--bg-1)}
.cont-hdr{display:flex;align-items:center;gap:10px;padding:12px 16px;cursor:pointer;user-select:none;background:var(--bg-2);transition:background .2s}
.cont-hdr:hover{background:var(--bg-3)}
.cont-emoji{font-size:17px}
.cont-name{font-weight:800;font-size:13px}
.cont-acc{font-size:11px;padding:2px 9px;border-radius:99px;font-weight:700;background:rgba(99,102,241,.1);color:var(--indigo)}
.cont-acc.good{background:rgba(16,185,129,.1);color:var(--emerald)}
.cont-acc.bad{background:rgba(244,63,94,.1);color:var(--rose)}
.cont-pw{flex:1;background:var(--bg-3);height:4px;border-radius:99px;overflow:hidden;margin:0 6px}
.cont-pf{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--emerald),var(--cyan));transition:width .5s ease}
.cont-cnt{font-size:11px;color:var(--text-3);font-family:'JetBrains Mono',monospace;white-space:nowrap}
.cont-chev{color:var(--text-3);font-size:11px;transition:transform .25s}
.cont-sec.open .cont-chev{transform:rotate(180deg)}
.cont-body{display:none;padding:10px;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:7px}
.cont-sec.open .cont-body{display:grid}

/* COUNTRY CARD */
.ccard{display:flex;align-items:center;gap:9px;padding:9px 11px;border-radius:var(--rs);background:var(--bg-2);border:1px solid rgba(255,255,255,.05);cursor:pointer;transition:border-color .2s,background .2s,transform .15s;position:relative;overflow:hidden}
.ccard:hover{border-color:rgba(99,102,241,.35);background:var(--bg-3);transform:translateY(-1px)}
.ccard.p{border-color:rgba(255,255,255,.05)}
.ccard.r{border-color:var(--indigo);background:rgba(99,102,241,.08);animation:cpulse .9s ease-in-out infinite alternate}
.ccard.c{border-color:rgba(16,185,129,.3);background:rgba(16,185,129,.05)}
.ccard.w{border-color:rgba(244,63,94,.3);background:rgba(244,63,94,.05)}
@keyframes cpulse{from{box-shadow:none}to{box-shadow:0 0 12px rgba(99,102,241,.2)}}
.cflag{font-size:19px;flex-shrink:0;line-height:1}
.cinfo{flex:1;min-width:0}
.cname{font-size:12px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cmeta{font-size:10px;color:var(--text-3);margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cqb{font-size:10px;font-family:'JetBrains Mono',monospace;font-weight:600;padding:2px 5px;border-radius:4px;background:var(--bg-3);color:var(--text-3);white-space:nowrap;flex-shrink:0}
.cicon{font-size:13px;flex-shrink:0}
.cicon.p{color:var(--text-3)}.cicon.r{color:var(--indigo);animation:spin .7s linear infinite}.cicon.c{color:var(--emerald)}.cicon.w{color:var(--rose)}
@keyframes spin{to{transform:rotate(360deg)}}

/* DRAWER */
.dov{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.75);backdrop-filter:blur(8px);opacity:0;pointer-events:none;transition:opacity .3s}
.dov.open{opacity:1;pointer-events:all}
.drawer{position:fixed;bottom:0;left:0;right:0;z-index:210;background:var(--bg-1);border-top:1px solid rgba(255,255,255,.08);border-radius:var(--rl) var(--rl) 0 0;max-height:85vh;display:flex;flex-direction:column;transform:translateY(100%);transition:transform .35s cubic-bezier(.4,0,.2,1)}
.drawer.open{transform:translateY(0)}
.dhandle{padding:12px;display:flex;justify-content:center;flex-shrink:0}
.dbar{width:40px;height:4px;background:var(--bg-4);border-radius:99px}
.dhdr{display:flex;align-items:center;gap:13px;padding:0 20px 14px;flex-shrink:0}
.dflag{font-size:34px}
.dname{font-size:17px;font-weight:800}
.dsub{font-size:11px;color:var(--text-3);margin-top:2px}
.dclose{margin-left:auto;width:30px;height:30px;border-radius:50%;background:var(--bg-3);border:1px solid rgba(255,255,255,.08);color:var(--text-2);display:flex;align-items:center;justify-content:center;transition:var(--tr)}
.dclose:hover{background:var(--bg-4);color:var(--text-1)}
.dbanner{display:flex;align-items:center;gap:10px;padding:11px 20px;font-size:13px;font-weight:700;flex-shrink:0}
.dbanner.p{background:rgba(99,102,241,.08);color:var(--indigo)}
.dbanner.c{background:rgba(16,185,129,.1);color:var(--emerald)}
.dbanner.w{background:rgba(244,63,94,.1);color:var(--rose)}
.dbody{flex:1;overflow-y:auto;padding:0 20px 12px}
.dmd{font-family:'JetBrains Mono',monospace;font-size:12px;line-height:1.8;color:var(--text-2);white-space:pre-wrap;word-break:break-word}
.dph{display:flex;flex-direction:column;align-items:center;gap:12px;padding:48px;color:var(--text-3);text-align:center}
.dph i{font-size:40px;opacity:.25}.dph p{font-size:13px}
.dact{display:flex;gap:10px;padding:14px 20px;border-top:1px solid rgba(255,255,255,.06);flex-shrink:0;flex-wrap:wrap}

/* REPORT */
.rsec{margin-top:36px}
.shdr{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.shtitle{font-size:14px;font-weight:800;display:flex;align-items:center;gap:7px}
.shtitle i{color:var(--indigo)}
.shsp{flex:1}
.rbox{background:var(--bg-1);border:1px solid rgba(255,255,255,.06);border-radius:var(--r);overflow:hidden;max-height:0;transition:max-height .4s ease;display:flex;flex-direction:column}
.rbox.open{max-height:700px}
.rbody{flex:1;overflow-y:auto;padding:18px}
pre.rmd{font-family:'JetBrains Mono',monospace;font-size:12px;line-height:1.8;color:var(--text-2);white-space:pre-wrap;word-break:break-word}

/* CONSOLE */
.csec{margin-top:28px}
.logbox{background:var(--bg-1);border:1px solid rgba(255,255,255,.06);border-radius:var(--r);height:200px;overflow-y:auto;padding:12px 16px;font-family:'JetBrains Mono',monospace;font-size:12px;line-height:1.7}
.ll{display:flex;gap:8px}
.lts{color:var(--text-3);flex-shrink:0}
.lok{color:var(--emerald)}.lerr{color:var(--rose)}.lwarn{color:var(--amber)}.linfo{color:var(--sky)}

/* TOAST */
#tc{position:fixed;bottom:24px;right:20px;z-index:999;display:flex;flex-direction:column;gap:8px}
.t{padding:11px 17px;background:var(--bg-2);border:1px solid rgba(255,255,255,.08);border-left:3px solid var(--indigo);border-radius:var(--rs);font-size:13px;font-weight:600;box-shadow:0 8px 32px rgba(0,0,0,.5);animation:tin .3s ease;max-width:310px}
.t.ok{border-left-color:var(--emerald)}.t.err{border-left-color:var(--rose)}.t.warn{border-left-color:var(--amber)}
@keyframes tin{from{transform:translateX(28px);opacity:0}to{transform:translateX(0);opacity:1}}

/* EMPTY STATE */
.es{display:flex;flex-direction:column;align-items:center;gap:12px;padding:60px;color:var(--text-3);text-align:center}
.es i{font-size:44px;opacity:.22}.es p{font-size:13px;max-width:280px;line-height:1.6}

footer{text-align:center;padding:28px;font-size:12px;color:var(--text-3)}
footer a{color:var(--indigo)}
</style>
</head>
<body>
<div class="orbs"><div class="orb o1"></div><div class="orb o2"></div><div class="orb o3"></div></div>
<div id="tc"></div>

<!-- Settings -->
<div class="sov" id="sov" onclick="closeCfg()"></div>
<div class="spanel" id="spanel">
  <div class="stitle"><i class="fa-solid fa-gear"></i>Configuration</div>
  <div class="sgrid">
    <div class="sf">
      <label><i class="fa-solid fa-server"></i>Backend URL</label>
      <input type="url" id="cUrl" class="si" placeholder="https://your-space.hf.space">
      <div class="shint"><i class="fa-solid fa-triangle-exclamation"></i>No trailing slash</div>
    </div>
    <div class="sf">
      <label><i class="fa-brands fa-github"></i>GitHub Token</label>
      <input type="password" id="cToken" class="si" placeholder="ghp_xxxxxxxxxxxx">
      <div class="shint"><i class="fa-solid fa-triangle-exclamation"></i>repo:write scope needed</div>
    </div>
    <div class="sf">
      <label><i class="fa-solid fa-user"></i>GitHub Owner</label>
      <input type="text" id="cOwner" class="si" placeholder="rafsan1711">
    </div>
    <div class="sf">
      <label><i class="fa-solid fa-code-branch"></i>Repo Name</label>
      <input type="text" id="cRepo" class="si" placeholder="geoai">
    </div>
    <div class="sf full">
      <label><i class="fa-solid fa-code-branch"></i>Branch</label>
      <input type="text" id="cBranch" class="si" placeholder="main">
    </div>
  </div>
  <div class="srow">
    <div class="srow-label"><i class="fa-solid fa-bolt" style="color:var(--amber);margin-right:6px"></i>Parallel Concurrency</div>
    <div class="cc">
      <button onclick="adjC(-5)">âˆ’</button>
      <span class="ccv" id="ccv">30</span>
      <button onclick="adjC(5)">+</button>
    </div>
  </div>
  <div class="shint" style="margin-top:8px"><i class="fa-solid fa-circle-info"></i>
    Gunicorn default = 2 workers. Start at 15â€“30. If you see HTTP 500/429, lower it. For gthread/gevent workers, go higher.
  </div>
  <div class="sact">
    <button class="btn btn-g btn-sm" onclick="closeCfg()"><i class="fa-solid fa-xmark"></i>Cancel</button>
    <button class="btn btn-p btn-sm" onclick="saveCfg()"><i class="fa-solid fa-floppy-disk"></i>Save & Close</button>
  </div>
</div>

<div id="app">
  <nav>
    <a href="/" class="logo">
      <span style="font-size:20px">ğŸŒ</span>
      <span>GeoAI</span>
      <span class="logo-badge">Bot v2.0</span>
    </a>
    <div class="spacer"></div>
    <a href="/" class="nbtn"><i class="fa-solid fa-house"></i><span>Home</span></a>
    <a href="https://github.com/rafsan1711/geoai" target="_blank" class="nbtn"><i class="fa-brands fa-github"></i><span>Repo</span></a>
    <button class="nbtn" id="cfgBtn" onclick="toggleCfg()"><i class="fa-solid fa-gear"></i><span>Config</span></button>
  </nav>

  <section class="hero">
    <div class="hero-badge"><i class="fa-solid fa-robot"></i>Automated Accuracy Benchmark</div>
    <h1 class="hero-title">GeoAI Bot Runner</h1>
    <p class="hero-sub">Runs parallel games for every country. Tracks effectiveness, confusion pairs, and generates a deep analytical REPORT.md.</p>
    <div class="cstatus">
      <span class="cpill warn" id="pB"><i class="fa-solid fa-circle"></i>Backend: Not Set</span>
      <span class="cpill warn" id="pG"><i class="fa-solid fa-circle"></i>GitHub: Not Set</span>
      <span class="cpill warn" id="pH"><i class="fa-solid fa-circle"></i>Health: Unknown</span>
    </div>
    <div class="rctrl">
      <button class="btn btn-p" id="runBtn" onclick="startRun()"><i class="fa-solid fa-bolt"></i>Run All Countries</button>
      <button class="btn btn-d" id="stopBtn" onclick="stopRun()" style="display:none"><i class="fa-solid fa-stop"></i>Stop</button>
      <button class="btn btn-g" id="pushBtn" onclick="pushResults()" disabled><i class="fa-brands fa-github"></i>Push to GitHub</button>
      <button class="btn btn-g" id="dlBtn" onclick="dlReport()" disabled><i class="fa-solid fa-download"></i>Download Report</button>
    </div>
    <div class="ltimer" id="lt">
      <div class="ldot"></div>
      <div class="lval">Elapsed: <b id="ltE">0s</b> &nbsp;|&nbsp; ETA: <b id="ltETA">â€”</b> &nbsp;|&nbsp; Rate: <b id="ltR">â€”</b></div>
    </div>
  </section>

  <div class="wrap">
    <!-- Stats -->
    <div class="sbar">
      <div class="sitem"><div class="sv blue" id="sT">â€”</div><div class="sl">Total</div></div>
      <div class="sitem"><div class="sv purple" id="sD">0</div><div class="sl">Done</div></div>
      <div class="sitem"><div class="sv green" id="sC">0</div><div class="sl">Correct</div></div>
      <div class="sitem"><div class="sv red" id="sW">0</div><div class="sl">Wrong</div></div>
      <div class="sitem"><div class="sv amber" id="sA">â€”</div><div class="sl">Accuracy</div></div>
      <div class="sitem si4"><div class="sv cyan" id="sQ">â€”</div><div class="sl">Avg Qs</div></div>
      <div class="sitem si4"><div class="sv indigo" id="sR">0</div><div class="sl">Running</div></div>
    </div>

    <!-- Progress -->
    <div class="pwrap">
      <div class="phdr">
        <div class="ptitle"><i class="fa-solid fa-chart-simple"></i>Overall Progress</div>
        <div class="pmeta" id="pmeta">Not started</div>
      </div>
      <div class="ptrack"><div class="pfill" id="pfill" style="width:0%"></div></div>
    </div>

    <!-- Grid -->
    <div id="grid"><div class="es"><i class="fa-solid fa-earth-americas"></i><p>Set Backend URL and click <b>Run All Countries</b></p></div></div>

    <!-- Report -->
    <div class="rsec" id="rsec" style="display:none">
      <div class="shdr">
        <div class="shtitle"><i class="fa-solid fa-file-lines"></i>REPORT.md Preview</div>
        <div class="shsp"></div>
        <button class="btn btn-g btn-sm" onclick="toggleRbox()"><i class="fa-solid fa-chevron-down"></i>Toggle</button>
      </div>
      <div class="rbox" id="rbox"><div class="rbody"><pre class="rmd" id="rmd"></pre></div></div>
    </div>

    <!-- Console -->
    <div class="csec">
      <div class="shdr">
        <div class="shtitle"><i class="fa-solid fa-terminal"></i>Console</div>
        <div class="shsp"></div>
        <button class="btn btn-g btn-sm" onclick="clearLog()"><i class="fa-solid fa-trash"></i>Clear</button>
      </div>
      <div class="logbox" id="logbox"></div>
    </div>
  </div>

  <footer>GeoAI Bot Runner v2.0 &nbsp;Â·&nbsp; <a href="https://github.com/rafsan1711/geoai">github.com/rafsan1711/geoai</a> &nbsp;Â·&nbsp; GPL-3.0</footer>
</div>

<!-- Drawer -->
<div class="dov" id="dov" onclick="closeDrawer()"></div>
<div class="drawer" id="drawer">
  <div class="dhandle"><div class="dbar"></div></div>
  <div class="dhdr">
    <span class="dflag" id="dF">ğŸ³</span>
    <div><div class="dname" id="dN">â€”</div><div class="dsub" id="dS">â€”</div></div>
    <button class="dclose" onclick="closeDrawer()"><i class="fa-solid fa-xmark"></i></button>
  </div>
  <div class="dbanner p" id="dban"><i class="fa-solid fa-clock"></i><span id="dbanT">Not run yet</span></div>
  <div class="dbody" id="dbody"><div class="dph"><i class="fa-solid fa-file-code"></i><p>Run this country to see debug report</p></div></div>
  <div class="dact">
    <button class="btn btn-g btn-sm" id="dDl" onclick="dlCountry()" style="display:none"><i class="fa-solid fa-download"></i>Download MD</button>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CFG = { url:'', token:'', owner:'rafsan1711', repo:'geoai', branch:'main', conc:30 };
const ST  = { countries:[], questions:[], results:{}, running:false, stop:false, start:null, timerH:null, drawer:null };
const CNT = { total:0, done:0, correct:0, wrong:0, running:0 };
// analytics
const QS  = {};   // attr â†’ {asked,totalDelta,wins,losses}
const CONF= {};   // actual â†’ {guessed â†’ count}
const CS  = {};   // continent â†’ {total,correct,wrong,totalQ,fastest,slowest}

const CMETA = {
  asia:        {label:'Asia',         emoji:'ğŸŒ'},
  europe:      {label:'Europe',       emoji:'ğŸŒ'},
  africa:      {label:'Africa',       emoji:'ğŸŒ'},
  northamerica:{label:'North America',emoji:'ğŸŒ'},
  southamerica:{label:'South America',emoji:'ğŸŒ'},
  oceania:     {label:'Oceania',      emoji:'ğŸŒ'},
};
const ORDINAL = {
  population:['tiny','small','medium','large','verylarge','huge'],
  size:['verysmall','small','medium','large','verylarge'],
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONFIG UI â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleCfg(){
  const p=document.getElementById('spanel'),o=document.getElementById('sov'),b=document.getElementById('cfgBtn');
  const open=p.classList.contains('open');
  if(!open){
    document.getElementById('cUrl').value=CFG.url;
    document.getElementById('cToken').value=CFG.token;
    document.getElementById('cOwner').value=CFG.owner;
    document.getElementById('cRepo').value=CFG.repo;
    document.getElementById('cBranch').value=CFG.branch;
    document.getElementById('ccv').textContent=CFG.conc;
  }
  p.classList.toggle('open',!open);o.classList.toggle('open',!open);b.classList.toggle('active',!open);
}
function closeCfg(){
  ['spanel','sov'].forEach(id=>document.getElementById(id).classList.remove('open'));
  document.getElementById('cfgBtn').classList.remove('active');
}
function saveCfg(){
  CFG.url=document.getElementById('cUrl').value.trim().replace(/\/$/,'');
  CFG.token=document.getElementById('cToken').value.trim();
  CFG.owner=document.getElementById('cOwner').value.trim()||'rafsan1711';
  CFG.repo=document.getElementById('cRepo').value.trim()||'geoai';
  CFG.branch=document.getElementById('cBranch').value.trim()||'main';
  CFG.conc=parseInt(document.getElementById('ccv').textContent)||30;
  closeCfg(); refreshPills(); toast('Settings saved','ok');
  log('Config saved â€” Backend: '+CFG.url,'info');
}
function adjC(d){const el=document.getElementById('ccv');el.textContent=Math.max(1,Math.min(195,(parseInt(el.textContent)||30)+d));}

function refreshPills(){
  const pB=document.getElementById('pB'),pG=document.getElementById('pG');
  if(CFG.url){pB.className='cpill ok';pB.innerHTML='<i class="fa-solid fa-circle-check"></i>Backend: Set';}
  else{pB.className='cpill err';pB.innerHTML='<i class="fa-solid fa-circle-xmark"></i>Backend: Missing';}
  if(CFG.token){pG.className='cpill ok';pG.innerHTML='<i class="fa-solid fa-circle-check"></i>GitHub: Set';}
  else{pG.className='cpill warn';pG.innerHTML='<i class="fa-solid fa-circle"></i>GitHub: Not Set';}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DATA LOADING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadData(){
  log('Loading countries.json and questions.jsonâ€¦','info');
  try{
    const [cR,qR]=await Promise.all([fetch('data/countries.json'),fetch('data/questions.json')]);
    if(!cR.ok) throw new Error('Cannot load data/countries.json');
    if(!qR.ok) throw new Error('Cannot load data/questions.json');
    const countries=await cR.json();
    const qRaw=await qR.json();
    ST.countries=countries;
    // questions.json is { "country": [...], "city": [...] } â€” extract country array
    ST.questions=Array.isArray(qRaw)?qRaw:(qRaw.country||Object.values(qRaw)[0]||[]);
    if(!ST.questions.length) throw new Error('No country questions found in questions.json');
    document.getElementById('sT').textContent=countries.length;
    log(`Loaded ${countries.length} countries, ${ST.questions.length} questions`,'ok');
    return true;
  }catch(e){log('Data load failed: '+e.message,'err');toast('Data load failed','err');return false;}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEALTH CHECK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function checkHealth(){
  const ph=document.getElementById('pH');
  ph.className='cpill warn'; ph.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i>Checkingâ€¦';
  try{
    const r=await fetch(CFG.url+'/health',{signal:AbortSignal.timeout(10000)});
    if(!r.ok) throw new Error('HTTP '+r.status);
    const d=await r.json();
    if(d.status==='healthy'){
      ph.className='cpill ok'; ph.innerHTML='<i class="fa-solid fa-circle-check"></i>Healthy';
      log('Backend healthy: '+JSON.stringify(d.data_stats),'ok'); return true;
    } throw new Error('Not healthy');
  }catch(e){ph.className='cpill err';ph.innerHTML='<i class="fa-solid fa-circle-xmark"></i>Offline';log('Health check FAILED: '+e.message,'err');return false;}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• API CALL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function apiCall(endpoint,method,data,retries=3){
  const url=CFG.url+endpoint;
  for(let attempt=1;attempt<=retries;attempt++){
    try{
      const res=await fetch(url,{
        method, headers:{'Content-Type':'application/json'},
        body:data?JSON.stringify(data):undefined,
        signal:AbortSignal.timeout(60000)
      });
      if(!res.ok){
        const err=await res.json().catch(()=>({}));
        // Only retry on 429 or 5xx
        if((res.status===429||res.status>=500)&&attempt<retries){
          await sleep(800*attempt); continue;
        }
        throw new Error(err.error||`HTTP ${res.status}`);
      }
      return res.json();
    }catch(e){
      if(attempt===retries) throw e;
      if(e.name==='TimeoutError') throw e; // don't retry timeouts
      await sleep(500*attempt);
    }
  }
}
const sleep=ms=>new Promise(r=>setTimeout(r,ms));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BOT ANSWER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function botAnswer(country,question){
  const attr=question.attribute, val=question.value;
  if(!(attr in country)) return 'dontknow';
  const cv=country[attr];

  if(typeof val==='boolean') return cv===val?'yes':'no';

  if(Array.isArray(cv)){
    const v=String(val).toLowerCase();
    if(cv.some(x=>String(x).toLowerCase()===v)) return 'yes';
    if(cv.some(x=>String(x).toLowerCase().includes(v)||v.includes(String(x).toLowerCase()))) return 'probably';
    return 'no';
  }

  const cvs=String(cv).toLowerCase(), qvs=String(val).toLowerCase();
  if(cvs===qvs) return 'yes';

  for(const [oa,order] of Object.entries(ORDINAL)){
    if(attr===oa){
      const ci=order.indexOf(cvs),qi=order.indexOf(qvs);
      if(ci!==-1&&qi!==-1){
        const d=Math.abs(ci-qi);
        if(d===0) return 'yes';
        if(d===1) return 'probably';
        if(d===2) return 'probablynot';
        return 'no';
      }
    }
  }
  return 'no';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PLAY ONE GAME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function playGame(country){
  const entries=[];
  let sid, qa=0, conf=0, pred=null;

  const s=await apiCall('/api/start-game','POST',{category:'country',questions:ST.questions});
  sid=s.session_id;

  for(let i=0;i<200;i++){
    if(ST.stop) throw new Error('STOPPED');
    const qr=await apiCall('/api/question','POST',{session_id:sid});
    qa=qr.questions_asked||qa;
    conf=qr.confidence||conf;
    if(qr.ready_to_guess||!qr.question) break;
    const q=qr.question;
    const ans=botAnswer(country,q);
    const entry={
      qNum:qa+1,attr:q.attribute,val:q.value,question:q.question,answer:ans,
      cB:qr.confidence||0,aB:qr.active_items_count||0,tB:qr.top_countries||[],
      cA:null,aA:null,tA:[]
    };
    const ar=await apiCall('/api/answer','POST',{session_id:sid,answer:ans});
    entry.cA=ar.confidence||0; entry.aA=ar.active_items_count||0; entry.tA=ar.top_countries||[];
    qa=ar.questions_asked||qa+1; conf=ar.confidence||conf;
    entries.push(entry);

    // track q effectiveness
    const delta=(entry.cA-entry.cB);
    if(!QS[entry.attr]) QS[entry.attr]={asked:0,totalDelta:0,wins:0,losses:0};
    QS[entry.attr].asked++; QS[entry.attr].totalDelta+=delta;

    if(ar.should_stop) break;
  }

  const pr=await apiCall('/api/predict','POST',{session_id:sid});
  pred=pr.prediction?.name||null;
  qa=pr.questions_asked||qa; conf=pr.confidence||conf;

  const guessed=!!(pred&&pred.toLowerCase()===country.name.toLowerCase());

  // analytics
  entries.forEach(e=>{if(guessed)QS[e.attr].wins++;else QS[e.attr].losses++;});
  if(!guessed&&pred){
    if(!CONF[country.name]) CONF[country.name]={};
    CONF[country.name][pred]=(CONF[country.name][pred]||0)+1;
  }
  const cont=country.continent||'unknown';
  if(!CS[cont]) CS[cont]={total:0,correct:0,wrong:0,totalQ:0,fastest:null,slowest:null};
  const cs=CS[cont]; cs.total++; cs.totalQ+=qa;
  if(guessed){cs.correct++;if(!cs.fastest||qa<cs.fastest.q)cs.fastest={name:country.name,q:qa};}
  else cs.wrong++;
  if(!cs.slowest||qa>cs.slowest.q) cs.slowest={name:country.name,q:qa};

  const md=buildDebugMd(country,entries,guessed,pred,conf,qa);
  return {guessed,prediction:pred,questionsAsked:qa,confidence:conf,mdContent:md};
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RUN ORCHESTRATION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function startRun(){
  if(ST.running) return;
  if(!CFG.url){toast('Set Backend URL first','warn');toggleCfg();return;}

  if(!ST.countries.length){const ok=await loadData();if(!ok)return;}

  const healthy=await checkHealth();
  if(!healthy){toast('Backend offline. Cannot run.','err');return;}

  // RESET
  ST.running=true; ST.stop=false; ST.start=Date.now();
  Object.assign(CNT,{total:ST.countries.length,done:0,correct:0,wrong:0,running:0});
  ST.results={};
  for(const k of Object.keys(QS)) delete QS[k];
  for(const k of Object.keys(CONF)) delete CONF[k];
  for(const k of Object.keys(CS)) delete CS[k];

  ST.countries.forEach(c=>{ST.results[c.name]={status:'pending',guessed:false,questionsAsked:0,confidence:0,prediction:null,mdContent:''};});

  renderGrid();
  updateStats();

  document.getElementById('runBtn').disabled=true;
  document.getElementById('runBtn').classList.add('running');
  document.getElementById('stopBtn').style.display='';
  document.getElementById('pushBtn').disabled=true;
  document.getElementById('dlBtn').disabled=true;
  document.getElementById('rsec').style.display='none';
  document.getElementById('lt').classList.add('on');

  startTimer();
  log(`ğŸš€ Starting run â€” ${ST.countries.length} countries, concurrency=${CFG.conc}`,'info');

  // TRUE parallel with concurrency limit
  const queue=[...ST.countries];
  let active=0;
  await new Promise(resolve=>{
    function next(){
      while(active<CFG.conc&&queue.length){
        if(ST.stop) break;
        const country=queue.shift();
        active++; CNT.running++; updateStats();
        setCard(country.name,'r');

        playGame(country).then(res=>{
          if(ST.stop){setCard(country.name,'p');return;}
          ST.results[country.name]={status:res.guessed?'correct':'wrong',...res};
          CNT.done++; CNT.running--;
          if(res.guessed) CNT.correct++; else CNT.wrong++;
          setCard(country.name,res.guessed?'c':'w',res.questionsAsked);
          log(`${res.guessed?'âœ…':'âŒ'} ${country.name} â†’ "${res.prediction}" | ${res.questionsAsked}q | ${res.confidence}%`,res.guessed?'ok':'err');
        }).catch(e=>{
          if(ST.stop) return;
          ST.results[country.name].status='wrong';
          CNT.done++; CNT.running++; CNT.wrong++;
          setCard(country.name,'w');
          log(`âŒ ${country.name} â€” ${e.message}`,'err');
        }).finally(()=>{
          active--;
          updateStats(); updateProgress();
          if(queue.length&&!ST.stop) next();
          else if(active===0) resolve();
        });
      }
      if(active===0) resolve();
    }
    next();
  });

  finalize();
}

function finalize(){
  ST.running=false; stopTimer();
  document.getElementById('runBtn').disabled=false;
  document.getElementById('runBtn').classList.remove('running');
  document.getElementById('stopBtn').style.display='none';
  document.getElementById('lt').classList.remove('on');

  if(ST.stop){log('âš ï¸ Run stopped by user.','warn');return;}

  const acc=CNT.done?(CNT.correct/CNT.done*100).toFixed(1):'0.0';
  log(`\nğŸ Complete! Accuracy: ${acc}% (${CNT.correct}/${CNT.done}) | Time: ${elapsed()}`,'ok');
  toast(`Done! ${acc}% accuracy (${CNT.correct}/${CNT.done})`,'ok');

  const md=buildReportMd();
  document.getElementById('rmd').textContent=md;
  document.getElementById('rsec').style.display='';
  document.getElementById('rbox').classList.add('open');
  document.getElementById('pushBtn').disabled=!CFG.token;
  document.getElementById('dlBtn').disabled=false;
  updateStats(); updateProgress();
}

function stopRun(){
  ST.stop=true; ST.running=false;
  document.getElementById('stopBtn').style.display='none';
  log('Stop requestedâ€¦','warn'); toast('Stoppingâ€¦','warn');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TIMER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function startTimer(){
  stopTimer();
  ST.timerH=setInterval(()=>{
    document.getElementById('ltE').textContent=elapsed();
    const s=(Date.now()-ST.start)/1000, done=CNT.done, total=CNT.total;
    if(done>0&&s>0){
      const rate=done/s;
      document.getElementById('ltR').textContent=(rate*60).toFixed(1)+'/min';
      const rem=total-done;
      document.getElementById('ltETA').textContent=rem>0?fmtS(rem/rate):'Done';
    }
  },500);
}
function stopTimer(){clearInterval(ST.timerH);}
function elapsed(){return fmtS((Date.now()-(ST.start||Date.now()))/1000);}
function fmtS(s){const m=Math.floor(s/60),sec=Math.floor(s%60);return m>0?`${m}m ${sec}s`:`${sec}s`;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GRID â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderGrid(){
  const g=document.getElementById('grid'); g.innerHTML='';
  const groups={};
  ST.countries.forEach(c=>{const k=c.continent||'unknown';if(!groups[k])groups[k]=[];groups[k].push(c);});
  Object.entries(groups).forEach(([cont,cs])=>{
    const m=CMETA[cont]||{label:cont,emoji:'ğŸŒ'};
    const sec=document.createElement('div');
    sec.className='cont-sec open'; sec.dataset.cont=cont;
    sec.innerHTML=`
      <div class="cont-hdr" onclick="toggleCont(this)">
        <span class="cont-emoji">${m.emoji}</span>
        <span class="cont-name">${m.label}</span>
        <span class="cont-acc" id="ca-${cont}">â€”</span>
        <div class="cont-pw"><div class="cont-pf" id="cf-${cont}" style="width:0%"></div></div>
        <span class="cont-cnt" id="cc-${cont}">0/${cs.length}</span>
        <i class="fa-solid fa-chevron-down cont-chev"></i>
      </div>
      <div class="cont-body" id="cb-${cont}"></div>`;
    const body=sec.querySelector(`#cb-${cont}`);
    cs.forEach(c=>{
      const card=document.createElement('div');
      card.className='ccard p'; card.id='card-'+enc(c.name);
      card.onclick=()=>openDrawer(c.name);
      card.innerHTML=`
        <span class="cflag">${c.emoji||'ğŸ³'}</span>
        <div class="cinfo">
          <div class="cname">${c.name}</div>
          <div class="cmeta" id="cm-${enc(c.name)}">${c.region||''}${c.subRegion?' Â· '+c.subRegion:''}</div>
        </div>
        <span class="cqb" id="cq-${enc(c.name)}" style="display:none"></span>
        <span class="cicon p" id="ci-${enc(c.name)}"><i class="fa-regular fa-clock"></i></span>`;
      body.appendChild(card);
    });
    g.appendChild(sec);
  });
}
function toggleCont(h){
  const sec=h.closest('.cont-sec'); sec.classList.toggle('open');
  const ch=h.querySelector('.cont-chev');
  if(ch) ch.style.transform=sec.classList.contains('open')?'rotate(180deg)':'';
}
function enc(n){return n.replace(/[^a-zA-Z0-9]/g,'_');}

function setCard(name,status,q){
  const id=enc(name);
  const card=document.getElementById('card-'+id);
  const icon=document.getElementById('ci-'+id);
  const qb=document.getElementById('cq-'+id);
  if(!card) return;
  card.className='ccard '+status;
  const icons={p:'<i class="fa-regular fa-clock"></i>',r:'<i class="fa-solid fa-spinner"></i>',c:'<i class="fa-solid fa-circle-check"></i>',w:'<i class="fa-solid fa-circle-xmark"></i>'};
  if(icon){icon.className='cicon '+status;icon.innerHTML=icons[status]||'';}
  if(q!==undefined&&qb){qb.style.display='';qb.textContent=q+'q';}
  const cont=ST.countries.find(c=>c.name===name)?.continent;
  if(cont) updateContProg(cont);
}
function updateContProg(cont){
  const cs=ST.countries.filter(c=>c.continent===cont);
  const done=cs.filter(c=>ST.results[c.name]?.status!=='pending').length;
  const corr=cs.filter(c=>ST.results[c.name]?.guessed).length;
  const fill=document.getElementById('cf-'+cont);
  const cntEl=document.getElementById('cc-'+cont);
  const accEl=document.getElementById('ca-'+cont);
  if(fill) fill.style.width=(done/cs.length*100)+'%';
  if(cntEl) cntEl.textContent=`${done}/${cs.length}`;
  if(accEl&&done>0){
    const a=(corr/done*100).toFixed(0)+'%';
    accEl.textContent=a;
    const pct=corr/done;
    accEl.className='cont-acc '+(pct>=0.9?'good':pct<0.7?'bad':'');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateStats(){
  document.getElementById('sT').textContent=CNT.total||'â€”';
  document.getElementById('sD').textContent=CNT.done;
  document.getElementById('sC').textContent=CNT.correct;
  document.getElementById('sW').textContent=CNT.wrong;
  document.getElementById('sA').textContent=CNT.done?(CNT.correct/CNT.done*100).toFixed(1)+'%':'â€”';
  document.getElementById('sR').textContent=CNT.running;
  const r=Object.values(ST.results).filter(r=>r.status!=='pending'&&r.questionsAsked);
  document.getElementById('sQ').textContent=r.length?(r.reduce((a,v)=>a+v.questionsAsked,0)/r.length).toFixed(1):'â€”';
}
function updateProgress(){
  const pct=CNT.total?Math.round(CNT.done/CNT.total*100):0;
  document.getElementById('pfill').style.width=pct+'%';
  document.getElementById('pmeta').textContent=`${CNT.done} / ${CNT.total} (${pct}%)`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DRAWER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openDrawer(name){
  const c=ST.countries.find(x=>x.name===name); if(!c) return;
  ST.drawer=name;
  document.getElementById('dF').textContent=c.emoji||'ğŸ³';
  document.getElementById('dN').textContent=c.name;
  document.getElementById('dS').textContent=[c.continent,c.region,c.subRegion].filter(Boolean).join(' Â· ');
  const r=ST.results[name], ban=document.getElementById('dban'), bt=document.getElementById('dbanT');
  const dl=document.getElementById('dDl'), body=document.getElementById('dbody');
  if(!r||r.status==='pending'){
    ban.className='dbanner p'; ban.querySelector('i').className='fa-solid fa-clock';
    bt.textContent='Not run yet';
    body.innerHTML='<div class="dph"><i class="fa-solid fa-file-code"></i><p>Run this country to see debug report</p></div>';
    dl.style.display='none';
  } else {
    if(r.guessed){ban.className='dbanner c';ban.querySelector('i').className='fa-solid fa-circle-check';bt.textContent=`Correct in ${r.questionsAsked}q â€” ${r.confidence}% confidence`;}
    else{ban.className='dbanner w';ban.querySelector('i').className='fa-solid fa-circle-xmark';bt.textContent=`Wrong â€” guessed "${r.prediction}" | ${r.questionsAsked}q | ${r.confidence}%`;}
    body.innerHTML=`<pre class="dmd">${esc(r.mdContent)}</pre>`;
    dl.style.display='';
  }
  document.getElementById('dov').classList.add('open');
  document.getElementById('drawer').classList.add('open');
}
function closeDrawer(){document.getElementById('dov').classList.remove('open');document.getElementById('drawer').classList.remove('open');ST.drawer=null;}
function dlCountry(){const r=ST.results[ST.drawer];if(r?.mdContent) saveBlob(r.mdContent,ST.drawer+'.md','text/markdown');}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• REPORT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleRbox(){document.getElementById('rbox').classList.toggle('open');}
function dlReport(){const md=document.getElementById('rmd').textContent;if(md) saveBlob(md,'REPORT.md','text/markdown');}
function saveBlob(content,fname,mime){
  const u=URL.createObjectURL(new Blob([content],{type:mime}));
  const a=document.createElement('a');a.href=u;a.download=fname;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(u);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GITHUB PUSH â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function pushResults(){
  if(!CFG.token){toast('GitHub token not set','warn');toggleCfg();return;}
  const ran=Object.entries(ST.results).filter(([,r])=>r.status!=='pending');
  if(!ran.length){toast('No results to push','warn');return;}
  document.getElementById('pushBtn').disabled=true;
  toast('Pushing to GitHubâ€¦','info'); log('Starting GitHub pushâ€¦','info');

  const base=`https://api.github.com/repos/${CFG.owner}/${CFG.repo}/contents/`;
  const hdrs={'Authorization':'Bearer '+CFG.token,'Content-Type':'application/json','Accept':'application/vnd.github.v3+json','X-GitHub-Api-Version':'2022-11-28'};

  let pushed=0,failed=0;
  for(const [name,r] of ran){
    if(!r.mdContent) continue;
    try{await ghPut(base,`Debug/Countries/${name}.md`,r.mdContent,hdrs,`bot: debug ${name}`);pushed++;}
    catch(e){failed++;log(`  Failed: ${name} â€” ${e.message}`,'err');}
    if(pushed%10===0&&pushed>0) log(`  Pushed ${pushed} filesâ€¦`,'info');
  }
  try{
    await ghPut(base,'Debug/REPORT.md',buildReportMd(),hdrs,'bot: update REPORT.md');
    log('Pushed Debug/REPORT.md','ok');
  }catch(e){failed++;log('Failed REPORT.md: '+e.message,'err');}

  document.getElementById('pushBtn').disabled=false;
  log(`Push done. ${pushed} pushed, ${failed} failed.`,failed?'warn':'ok');
  toast(`Pushed ${pushed} files (${failed} failed)`,failed?'warn':'ok');
}

// â”€â”€ FIXED githubPutFile â€” proper Unicode base64 + correct path encoding â”€â”€
async function ghPut(base,path,content,headers,msg){
  // Encode path segments individually (don't encode slashes)
  const encodedPath=path.split('/').map(encodeURIComponent).join('/');
  const url=base+encodedPath;

  // Unicode-safe base64
  const b64=btoa(Array.from(new TextEncoder().encode(content)).map(b=>String.fromCharCode(b)).join(''));

  // Get existing SHA if file exists (required for updates)
  let sha=null;
  try{
    const r=await fetch(`${url}?ref=${CFG.branch}`,{headers});
    if(r.ok){const d=await r.json();sha=d.sha||null;}
  }catch(_){}

  const body={message:msg,content:b64,branch:CFG.branch};
  if(sha) body.sha=sha;
  const res=await fetch(url,{method:'PUT',headers,body:JSON.stringify(body)});
  if(!res.ok){const e=await res.json().catch(()=>({}));throw new Error(e.message||`HTTP ${res.status}`);}
  return res.json();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DEBUG MD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildDebugMd(country,entries,guessed,pred,conf,qa){
  const now=new Date().toISOString(); const L=[];
  L.push(`# GeoAI Debug Report â€” ${country.emoji||''} ${country.name}`);
  L.push('');L.push('## ğŸ“‹ Summary');L.push('');
  L.push('| Field | Value |');L.push('|-------|-------|');
  L.push(`| Country | ${country.emoji||''} **${country.name}** |`);
  L.push(`| Continent | ${country.continent||'â€”'} |`);
  L.push(`| Region | ${country.region||'â€”'} Â· ${country.subRegion||'â€”'} |`);
  L.push(`| Population | ${country.population||'â€”'} |`);
  L.push(`| Result | ${guessed?'âœ… **CORRECT**':'âŒ **WRONG**'} |`);
  L.push(`| AI Guessed | ${pred||'â€”'} |`);
  L.push(`| Confidence | ${conf}% |`);
  L.push(`| Questions Asked | ${qa} |`);
  L.push(`| Generated | ${now} |`);
  L.push('');
  if(!guessed&&pred) L.push(`> âš ï¸ Bot thought of **${pred}** instead of **${country.name}**\n`);
  L.push('---\n\n## ğŸ” Question-by-Question Log\n');

  entries.forEach((e,i)=>{
    const al={yes:'âœ… Yes',probably:'ğŸŸ¡ Probably',dontknow:"â“ Don't Know",probablynot:'ğŸŸ  Probably Not',no:'âŒ No'}[e.answer]||e.answer;
    const delta=(e.cA!==null?(e.cA-e.cB).toFixed(1):null);
    const arr=delta===null?'':parseFloat(delta)>0?'ğŸ“ˆ':parseFloat(delta)<0?'ğŸ“‰':'â¡ï¸';
    L.push(`### Q${i+1}: ${e.question}`);L.push('');
    L.push(`- **Attribute:** \`${e.attr}\` = \`${e.val}\``);
    L.push(`- **Answer:** ${al}`);
    if(delta!==null) L.push(`- **Confidence:** ${e.cB}% â†’ ${e.cA}% ${arr} (${parseFloat(delta)>0?'+':''}${delta})`);
    L.push(`- **Active Countries:** ${e.aB} â†’ ${e.aA}`);L.push('');
    if(e.tB?.length){L.push('**Top before:**');L.push('| Rank | Country | Prob |');L.push('|------|---------|------|');e.tB.forEach((c,j)=>L.push(`| ${j+1} | ${c.name} | ${c.prob}% |`));L.push('');}
    if(e.tA?.length){
      const bm={};(e.tB||[]).forEach(c=>bm[c.name]=c.prob);
      L.push('**Top after:**');L.push('| Rank | Country | Prob | Î” |');L.push('|------|---------|------|---|');
      e.tA.forEach((c,j)=>{const p=bm[c.name];const d=p!==undefined?(c.prob-p).toFixed(2):'new';const a=d==='new'?'ğŸ†•':parseFloat(d)>0?`+${d}%ğŸ“ˆ`:parseFloat(d)<0?`${d}%ğŸ“‰`:'Â±0%';L.push(`| ${j+1} | ${c.name} | ${c.prob}% | ${a} |`);});
      L.push('');
    }
    L.push('---\n');
  });

  L.push('## ğŸ¯ Final Guess\n');
  L.push('| | |');L.push('|--|--|');
  L.push(`| **Prediction** | ${pred||'â€”'} |`);
  L.push(`| **Correct Answer** | ${country.name} |`);
  L.push(`| **Confidence** | ${conf}% |`);
  L.push(`| **Questions Asked** | ${qa} |`);
  L.push(`| **Verdict** | ${guessed?'âœ… CORRECT':'âŒ WRONG'} |`);
  return L.join('\n');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• REPORT MD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildReportMd(){
  const now=new Date(); const res=ST.results; const cs=ST.countries;
  const ran=Object.entries(res).filter(([,r])=>r.status!=='pending');
  const correct=ran.filter(([,r])=>r.guessed).length;
  const wrong=ran.length-correct;
  const acc=ran.length?(correct/ran.length*100).toFixed(2):'0.00';
  const totalQ=ran.reduce((a,[,r])=>a+r.questionsAsked,0);
  const avgQ=ran.length?(totalQ/ran.length).toFixed(1):'â€”';
  const elapsed_=ST.start?fmtS((now-ST.start)/1000):'â€”';
  const L=[];

  L.push('# ğŸŒ GeoAI Bot Test â€” Analytical Report');L.push('');
  L.push(`> **Generated:** ${now.toUTCString()}`);
  L.push(`> **Run Duration:** ${elapsed_}  |  **Concurrency:** ${CFG.conc}  |  **Bot v2.0**`);
  L.push('');L.push('---');L.push('');

  /* SECTION 1 â€” Executive Summary */
  L.push('## ğŸ“Š Section 1: Executive Summary');L.push('');
  L.push('| Metric | Value | Notes |');L.push('|--------|-------|-------|');
  L.push(`| **Overall Accuracy** | **${acc}%** | Target: â‰¥95% |`);
  L.push(`| Countries Tested | ${ran.length} / ${cs.length} | ${cs.length-ran.length} skipped |`);
  L.push(`| Correct | âœ… ${correct} | |`);L.push(`| Wrong | âŒ ${wrong} | |`);
  L.push(`| Avg Questions/Game | ${avgQ} | Lower = smarter |`);
  L.push(`| Total Questions Asked | ${totalQ} | |`);
  L.push(`| Run Duration | ${elapsed_} | |`);
  L.push(`| Status | ${parseFloat(acc)>=95?'âœ… TARGET MET (â‰¥95%)':parseFloat(acc)>=85?'âš ï¸ BELOW TARGET':'âŒ NEEDS WORK'} | |`);
  L.push('');

  /* SECTION 2 â€” Continent Breakdown */
  L.push('---');L.push('');L.push('## ğŸŒ Section 2: Performance by Continent');L.push('');
  L.push('| Continent | Total | âœ… | âŒ | Accuracy | Avg Qs | Fastest | Slowest |');
  L.push('|-----------|-------|----|----|----------|--------|---------|---------|');
  Object.entries(CS).sort((a,b)=>b[1].correct/b[1].total-a[1].correct/a[1].total).forEach(([cont,d])=>{
    const m=CMETA[cont]||{label:cont,emoji:'ğŸŒ'};
    const ca=d.total?(d.correct/d.total*100).toFixed(1):'0.0';
    const cq=d.total?(d.totalQ/d.total).toFixed(1):'â€”';
    const bar=Math.round(parseFloat(ca)/10);
    L.push(`| ${m.emoji} **${m.label}** | ${d.total} | ${d.correct} | ${d.wrong} | **${ca}%** \`${'â–ˆ'.repeat(bar)}${'â–‘'.repeat(10-bar)}\` | ${cq}q | ${d.fastest?d.fastest.name+' ('+d.fastest.q+'q)':'â€”'} | ${d.slowest?d.slowest.name+' ('+d.slowest.q+'q)':'â€”'} |`);
  });
  L.push('');L.push('### Continent Notes');L.push('');
  Object.entries(CS).forEach(([cont,d])=>{
    const m=CMETA[cont]||{label:cont,emoji:'ğŸŒ'};
    const p=d.total?d.correct/d.total:0;
    if(p<0.8) L.push(`- âš ï¸ **${m.label}** underperforming (${(p*100).toFixed(1)}%) â€” add more discriminative questions for this region.`);
    else if(p>=0.95) L.push(`- âœ… **${m.label}** excellent accuracy (${(p*100).toFixed(1)}%).`);
  });
  L.push('');

  /* SECTION 3 â€” Speed Analysis */
  L.push('---');L.push('');L.push('## âš¡ Section 3: Speed Analysis');L.push('');
  const byQ=ran.filter(([,r])=>r.guessed&&r.questionsAsked>0).sort((a,b)=>a[1].questionsAsked-b[1].questionsAsked);
  L.push('### ğŸ† Top 10 Fastest Correct Guesses');L.push('');
  L.push('| Rank | Country | Questions | Confidence |');L.push('|------|---------|-----------|------------|');
  byQ.slice(0,10).forEach(([n,r],i)=>{const c=cs.find(x=>x.name===n);L.push(`| ${i+1} | ${c?.emoji||''} ${n} | **${r.questionsAsked}** | ${r.confidence}% |`);});
  L.push('');
  L.push('### ğŸ¢ Top 10 Slowest Correct Guesses');L.push('');
  L.push('| Rank | Country | Questions | Confidence |');L.push('|------|---------|-----------|------------|');
  [...byQ].reverse().slice(0,10).forEach(([n,r],i)=>{const c=cs.find(x=>x.name===n);L.push(`| ${i+1} | ${c?.emoji||''} ${n} | **${r.questionsAsked}** | ${r.confidence}% |`);});
  L.push('');

  /* SECTION 4 â€” Wrong Answers */
  L.push('---');L.push('');L.push('## âŒ Section 4: Failed Cases');L.push('');
  const wList=ran.filter(([,r])=>!r.guessed);
  if(!wList.length){L.push('> ğŸ‰ **Perfect score!** No wrong answers.');}
  else{
    L.push(`> ${wList.length} wrong â€” analyze to improve dataset or algorithm.`);L.push('');
    L.push('| # | Country | Guessed As | Questions | Confidence | Debug |');
    L.push('|---|---------|------------|-----------|------------|-------|');
    wList.forEach(([n,r],i)=>{const c=cs.find(x=>x.name===n);L.push(`| ${i+1} | ${c?.emoji||''} **${n}** | ${r.prediction||'â€”'} | ${r.questionsAsked}q | ${r.confidence}% | [Debug](Countries/${n}.md) |`);});
  }
  L.push('');

  /* SECTION 5 â€” Confusion Analysis */
  L.push('---');L.push('');L.push('## ğŸ”€ Section 5: Confusion Analysis');L.push('');
  const pairs=[];
  Object.entries(CONF).forEach(([actual,gs])=>Object.entries(gs).forEach(([g,cnt])=>pairs.push({actual,guessed:g,count:cnt})));
  pairs.sort((a,b)=>b.count-a.count);
  if(!pairs.length){L.push('> No confusion data.');}
  else{
    L.push('| # | Actual | Guessed As | Times | Hint |');L.push('|---|--------|------------|-------|------|');
    pairs.slice(0,20).forEach((p,i)=>{
      const ca=cs.find(c=>c.name===p.actual), cg=cs.find(c=>c.name===p.guessed);
      const hint=ca?.region===cg?.region?'Same region â€” add sub-region questions':ca?.continent===cg?.continent?'Same continent â€” add regional questions':'Different continents â€” check data quality';
      L.push(`| ${i+1} | ${ca?.emoji||''} **${p.actual}** | ${cg?.emoji||''} ${p.guessed} | ${p.count}x | ${hint} |`);
    });
    L.push('');
    L.push('### Most Confused Countries');L.push('');
    Object.entries(CONF).filter(([,g])=>Object.keys(g).length>0).slice(0,8).forEach(([actual,gs])=>{
      const ca=cs.find(c=>c.name===actual);
      L.push(`**${ca?.emoji||''} ${actual}** was confused with:`);
      Object.entries(gs).sort((a,b)=>b[1]-a[1]).forEach(([g,n])=>{const cg=cs.find(c=>c.name===g);L.push(`- ${cg?.emoji||''} ${g} (${n}x)`);});
      L.push('');
    });
  }

  /* SECTION 6 â€” Question Effectiveness */
  L.push('---');L.push('');L.push('## ğŸ“ˆ Section 6: Question Attribute Effectiveness');L.push('');
  L.push('> Avg Confidence Î” per question â€” higher = more useful attribute.');L.push('');
  const qArr=Object.entries(QS).map(([a,d])=>({attr:a,asked:d.asked,avgDelta:d.asked?(d.totalDelta/d.asked).toFixed(2):'0',winPct:d.wins+d.losses>0?((d.wins/(d.wins+d.losses))*100).toFixed(0):'â€”'})).sort((a,b)=>parseFloat(b.avgDelta)-parseFloat(a.avgDelta));
  L.push('| Rank | Attribute | Asked | Avg Conf Î” | Win Rate | Verdict |');L.push('|------|-----------|-------|-----------|----------|---------|');
  qArr.forEach((q,i)=>{
    const d=parseFloat(q.avgDelta);
    const v=d>5?'ğŸ”¥ Highly Effective':d>2?'âœ… Effective':d>0?'ğŸŸ¡ Moderate':'ğŸ”´ Weak â€” Review';
    L.push(`| ${i+1} | \`${q.attr}\` | ${q.asked} | **${d>0?'+':''}${q.avgDelta}%** | ${q.winPct}% | ${v} |`);
  });
  L.push('');L.push('### ğŸ’¡ Weight Recommendations');L.push('');
  const strong=qArr.filter(q=>parseFloat(q.avgDelta)>5);
  const weak=qArr.filter(q=>parseFloat(q.avgDelta)<=0);
  if(strong.length) L.push(`**Increase weight for:** ${strong.map(q=>`\`${q.attr}\``).join(', ')}\n`);
  if(weak.length) L.push(`**Decrease weight / Review:** ${weak.map(q=>`\`${q.attr}\``).join(', ')}\n`);

  /* SECTION 7 â€” Tuning Suggestions */
  L.push('---');L.push('');L.push('## ğŸ”§ Section 7: Algorithm Tuning Suggestions');L.push('');
  const oa=parseFloat(acc);
  L.push(`**Current Accuracy:** ${acc}% â€” ${oa>=95?'âœ… Target Met':'âš ï¸ '+((95-oa).toFixed(2))+'% below 95% target'}\n`);
  if(pairs.length>0){const tp=pairs[0];L.push(`1. **Top confusion pair:** "${tp.actual}" â†” "${tp.guessed}" â€” add a question that discriminates these two countries.`);}
  const worstCont=Object.entries(CS).sort((a,b)=>a[1].correct/a[1].total-b[1].correct/b[1].total)[0];
  if(worstCont){const m=CMETA[worstCont[0]]||{label:worstCont[0]};const p=(worstCont[1].correct/worstCont[1].total*100).toFixed(1);L.push(`2. **Weakest continent:** ${m.label} (${p}%) â€” focus question expansion here.`);}
  if(qArr[0]) L.push(`3. **Best attribute:** \`${qArr[0].attr}\` (Î”=${qArr[0].avgDelta}%) â€” ensure asked early (Stage 0-2).`);
  if(weak.length>0) L.push(`4. **Weak attributes:** ${weak.map(q=>`\`${q.attr}\``).join(', ')} â€” consider removing or replacing these questions.`);
  const slowWrong=wList.filter(([,r])=>r.questionsAsked>20);
  if(slowWrong.length) L.push(`5. **${slowWrong.length} countries took >20 questions AND were wrong** â€” check their data for missing unique attributes.`);
  L.push('');

  /* SECTION 8 â€” Data Quality Flags */
  L.push('---');L.push('');L.push('## ğŸ´ Section 8: Data Quality Flags');L.push('');
  L.push('Countries that may need data enrichment (>20 questions AND wrong):\n');
  if(!slowWrong?.length){L.push('> âœ… No data quality flags.');}
  else{L.push('| Country | Questions | Suggestion |');L.push('|---------|-----------|------------|');slowWrong.forEach(([n,r])=>{const c=cs.find(x=>x.name===n);L.push(`| ${c?.emoji||''} **${n}** | ${r.questionsAsked}q | Add unique discriminating attributes |`);});}
  L.push('');

  /* SECTION 9 â€” Full Country Index */
  L.push('---');L.push('');L.push('## ğŸ“ Section 9: Full Country Index');L.push('');
  L.push('| Country | Result | Questions | Confidence | Predicted | Debug |');L.push('|---------|--------|-----------|------------|-----------|-------|');
  ran.sort((a,b)=>a[0].localeCompare(b[0])).forEach(([n,r])=>{
    const c=cs.find(x=>x.name===n);
    L.push(`| ${c?.emoji||''} ${n} | ${r.guessed?'âœ…':'âŒ'} | ${r.questionsAsked}q | ${r.confidence}% | ${r.prediction||'â€”'} | [Debug](Countries/${n}.md) |`);
  });
  L.push('');

  L.push('---');L.push('');
  L.push(`*GeoAI Bot Runner v2.0 â€” ${now.toUTCString()}*`);
  return L.join('\n');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOG / TOAST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function log(msg,type=''){
  const box=document.getElementById('logbox');
  const ts=new Date().toTimeString().slice(0,8);
  const p=document.createElement('div');
  p.className='ll';
  p.innerHTML=`<span class="lts">[${ts}]</span><span class="${type?'l'+type:''}">${esc(msg)}</span>`;
  box.appendChild(p); box.scrollTop=box.scrollHeight;
}
function clearLog(){document.getElementById('logbox').innerHTML='';log('Log cleared.','info');}
function toast(msg,type=''){
  const c=document.getElementById('tc');
  const t=document.createElement('div');
  t.className='t '+(type||''); t.textContent=msg;
  c.appendChild(t); setTimeout(()=>t.remove(),4000);
}
function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded',()=>{
  refreshPills();
  log('GeoAI Bot Runner v2.0 ready.','info');
  log('questions.json: auto-extracts "country" array key.','info');
  log('Default concurrency: 30 (safe for gunicorn 2-worker). Adjust in Config.','info');
  log('GitHub Push: fixed Unicode base64 + correct path encoding (no 422/404).','info');
});
</script>
</body>
</html>
